"use strict";const t=require("vue"),w=require("primevue/autocomplete"),I=require("primevue/inputgroup");require("axios");const q=require("primevue/inputtext"),V=require("pvtables/notify"),C=require("pvtables/api"),b={__name:"gtsAutoComplete",props:t.mergeModels({table:{type:String,required:!0},options:{type:Object,default:()=>[]}},{id:{type:String,default:""},idModifiers:{}}),emits:t.mergeModels(["update:id","set-value"],["update:id"]),setup(a,{emit:f}){const s=t.useModel(a,"id"),l=a,i=C(l.table),d=f,{notify:u}=V.useNotifications(),r=t.ref({});t.watchEffect(()=>{const[o]=l.options.filter(e=>s.value===e.id);o?r.value=o:r.value={}});const c=t.ref(""),p=t.ref([]),v=async({query:o})=>{try{const e=await i.autocomplete({query:o});p.value=e.data.rows}catch(e){u("error",{detail:e.message})}};async function g(o){return(await i.autocomplete({id:o})).data.rows[0]||null}const m=async o=>{const e=o.target.value;if(e===""||e==="0"){s.value=e,r.value={};return}try{const n=await g(o.target.value);if(!n){u("error",{detail:"Отсутствует такой ID"}),s.value=c.value;return}r.value=n,s.value=e}catch(n){u("error",{detail:n.message})}d("set-value")},y=o=>{s.value=o.value.id,d("set-value")};return(o,e)=>(t.openBlock(),t.createBlock(t.unref(I),{onKeydown:e[3]||(e[3]=t.withKeys(t.withModifiers(()=>{},["stop"]),["tab"]))},{default:t.withCtx(()=>[t.createVNode(t.unref(q),{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=n=>s.value=n),onBlur:m,onKeydown:t.withKeys(m,["enter"]),onFocus:e[1]||(e[1]=n=>c.value=s.value),class:"gts-ac__id-field"},null,8,["modelValue"]),t.createVNode(t.unref(w),{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=n=>r.value=n),dropdown:"","option-label":"content",suggestions:p.value,class:"gts-ac__search-field",onComplete:v,onItemSelect:y},null,8,["modelValue","suggestions"])]),_:1}))}};module.exports=b;
