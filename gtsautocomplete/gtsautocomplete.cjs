"use strict";const t=require("vue"),b=require("primevue/autocomplete"),w=require("primevue/inputgroup"),I=require("primevue/inputtext"),q=require("pvtables/notify"),V=require("pvtables/api"),C={__name:"gtsAutoComplete",props:t.mergeModels({table:{type:String,required:!0},disabled:{type:Boolean,default:!1},options:{type:Object,default:()=>[]},parent:{type:Object,default:()=>{}}},{id:{type:String,default:""},idModifiers:{}}),emits:t.mergeModels(["update:id","set-value"],["update:id"]),setup(u,{emit:v}){const a=t.useModel(u,"id"),n=u,i=V(n.table),d=v,{notify:l}=q.useNotifications(),s=t.ref({});t.watchEffect(async()=>{if(Array.isArray(n.options)&&n.options.length){const[o]=n.options.filter(e=>a.value===e.id);o?s.value=o:s.value={}}else if(Number(a.value)>0)try{const o=await f(a.value);if(!o){l("error",{detail:"Отсутствует такой ID"});return}s.value=o}catch(o){l("error",{detail:o.message})}});const c=t.ref(""),p=t.ref([]),y=async({query:o})=>{try{const e=await i.autocomplete({query:o,parent:n.parent});p.value=e.data.rows}catch(e){l("error",{detail:e.message})}};async function f(o){return(await i.autocomplete({id:o,parent:n.parent})).data.rows[0]||null}const m=async o=>{const e=o.target.value;if(e===""||e==="0"){a.value=e,s.value={};return}try{const r=await f(o.target.value);if(!r){l("error",{detail:"Отсутствует такой ID"}),a.value=c.value;return}s.value=r,a.value=e}catch(r){l("error",{detail:r.message})}d("set-value")},g=o=>{a.value=o.value.id,d("set-value")};return(o,e)=>(t.openBlock(),t.createBlock(t.unref(w),{onKeydown:e[3]||(e[3]=t.withKeys(t.withModifiers(()=>{},["stop"]),["tab"]))},{default:t.withCtx(()=>[t.createVNode(t.unref(I),{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=r=>a.value=r),onBlur:m,onKeydown:t.withKeys(m,["enter"]),onFocus:e[1]||(e[1]=r=>c.value=a.value),class:"gts-ac__id-field",disabled:u.disabled},null,8,["modelValue","disabled"]),t.createVNode(t.unref(b),{modelValue:s.value,"onUpdate:modelValue":e[2]||(e[2]=r=>s.value=r),dropdown:"","option-label":"content",suggestions:p.value,class:"gts-ac__search-field",onComplete:y,onItemSelect:g,disabled:u.disabled},null,8,["modelValue","suggestions","disabled"])]),_:1}))}};module.exports=C;
