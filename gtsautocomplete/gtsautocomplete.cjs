"use strict";const t=require("vue"),w=require("primevue/autocomplete"),b=require("primevue/inputgroup"),I=require("primevue/inputtext"),V=require("pvtables/notify"),q=require("pvtables/api"),C={__name:"gtsAutoComplete",props:t.mergeModels({table:{type:String,required:!0},disabled:{type:Boolean,default:!1},options:{type:Object,default:()=>[]}},{id:{type:String,default:""},idModifiers:{}}),emits:t.mergeModels(["update:id","set-value"],["update:id"]),setup(n,{emit:m}){const a=t.useModel(n,"id"),r=n,i=q(r.table),d=m,{notify:u}=V.useNotifications(),l=t.ref({});t.watchEffect(()=>{const[o]=r.options.filter(e=>a.value===e.id);o?l.value=o:l.value={}});const c=t.ref(""),p=t.ref([]),v=async({query:o})=>{try{const e=await i.autocomplete({query:o});p.value=e.data.rows}catch(e){u("error",{detail:e.message})}};async function y(o){return(await i.autocomplete({id:o})).data.rows[0]||null}const f=async o=>{const e=o.target.value;if(e===""||e==="0"){a.value=e,l.value={};return}try{const s=await y(o.target.value);if(!s){u("error",{detail:"Отсутствует такой ID"}),a.value=c.value;return}l.value=s,a.value=e}catch(s){u("error",{detail:s.message})}d("set-value")},g=o=>{a.value=o.value.id,d("set-value")};return(o,e)=>(t.openBlock(),t.createBlock(t.unref(b),{onKeydown:e[3]||(e[3]=t.withKeys(t.withModifiers(()=>{},["stop"]),["tab"]))},{default:t.withCtx(()=>[t.createVNode(t.unref(I),{modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=s=>a.value=s),onBlur:f,onKeydown:t.withKeys(f,["enter"]),onFocus:e[1]||(e[1]=s=>c.value=a.value),class:"gts-ac__id-field",disabled:n.disabled},null,8,["modelValue","disabled"]),t.createVNode(t.unref(w),{modelValue:l.value,"onUpdate:modelValue":e[2]||(e[2]=s=>l.value=s),dropdown:"","option-label":"content",suggestions:p.value,class:"gts-ac__search-field",onComplete:v,onItemSelect:g,disabled:n.disabled},null,8,["modelValue","suggestions","disabled"])]),_:1}))}};module.exports=C;
