"use strict";const t=require("vue"),y=require("primevue/autocomplete"),I=require("primevue/inputgroup"),m=require("axios"),V=require("primevue/inputtext"),q=require("pvtables/notify"),b={__name:"gtsAutoComplete",props:t.mergeModels({table:{type:String,required:!0},options:{type:Object,default:()=>[]}},{id:{type:String,default:""},idModifiers:{}}),emits:t.mergeModels(["update:id","set-value"],["update:id"]),setup(l,{emit:f}){const s=t.useModel(l,"id"),n=l,i=f,{notify:u}=q.useNotifications(),r=t.ref({});t.watchEffect(()=>{const[o]=n.options.filter(e=>s.value===e.id);o?r.value=o:r.value={}});const d=t.ref(""),c=t.ref([]),v=async({query:o})=>{try{const e=await m.post("/api/"+n.table,{},{params:{api_action:"autocomplete",query:o}});if(!e.data.success)throw new Error(e.data.message);c.value=e.data.data.rows}catch(e){u("error",e.message)}};async function g(o){const e=await m.post("/api/"+n.table,{},{params:{api_action:"autocomplete",id:o}});if(!e.data.success)throw new Error(e.data.message);return e.data.data.rows[0]||null}const p=async o=>{const e=o.target.value;if(e===""||e==="0"){s.value=e,r.value={};return}try{const a=await g(o.target.value);if(!a){u("error",{detail:"Отсутствует такой ID"}),s.value=d.value;return}r.value=a,s.value=e}catch(a){u("error",{detail:a.message})}i("set-value")},w=o=>{s.value=o.value.id,i("set-value")};return(o,e)=>(t.openBlock(),t.createBlock(t.unref(I),{onKeydown:e[3]||(e[3]=t.withKeys(t.withModifiers(()=>{},["stop"]),["tab"]))},{default:t.withCtx(()=>[t.createVNode(t.unref(V),{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value=a),onBlur:p,onKeydown:t.withKeys(p,["enter"]),onFocus:e[1]||(e[1]=a=>d.value=s.value),class:"gts-ac__id-field"},null,8,["modelValue"]),t.createVNode(t.unref(y),{modelValue:r.value,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value=a),dropdown:"","option-label":"content",suggestions:c.value,class:"gts-ac__search-field",onComplete:v,onItemSelect:w},null,8,["modelValue","suggestions"])]),_:1}))}};module.exports=b;
